{"version":3,"file":"ng-auto-position.mjs","sources":["../../src/app/ng-auto-position/ng-auto-position.directive.ts","../../src/ng-auto-position.ts"],"sourcesContent":["import {\r\n  AfterViewInit,\r\n  DestroyRef,\r\n  Directive,\r\n  ElementRef,\r\n  HostBinding,\r\n  inject,\r\n  input,\r\n} from '@angular/core';\r\nimport { fromEvent, merge } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { takeUntilDestroyed } from '@angular/core/rxjs-interop';\r\n\r\n/**\r\n * AutoPositionElementDirective\r\n *\r\n * Automatically positions an overlay element (dropdown / popover)\r\n * relative to a reference element and keeps it inside the viewport.\r\n *\r\n * DESIGN DECISIONS:\r\n * - Uses `position: fixed` so viewport math is reliable.\r\n * - Uses getBoundingClientRect() for all measurements.\r\n * - Avoids DOM depth assumptions (npm-safe).\r\n * - Uses ResizeObserver to react to size changes.\r\n */\r\n@Directive({\r\n  selector: '[ngAutoPosition]',\r\n  standalone: true,\r\n})\r\nexport class NgAutoPositionElementDirective implements AfterViewInit {\r\n  /** Native element reference for the overlay */\r\n  private readonly el = inject(ElementRef<HTMLElement>);\r\n\r\n  /** Used by Angular to auto-clean RxJS subscriptions */\r\n  private readonly destroyRef = inject(DestroyRef);\r\n\r\n  /**\r\n   * ID of the reference element.\r\n   * If not provided, parentElement is used.\r\n   */\r\n  referenceElementId = input<string | null>(null);\r\n\r\n  /** Debounce time for scroll / resize events (ms) */\r\n  debounceMs = input<number>(0);\r\n\r\n  /** Gap between reference and overlay (px) */\r\n  offset = input<number>(5);\r\n\r\n  /** Match overlay width to reference width */\r\n  matchWidth = input<boolean>(false);\r\n\r\n  /**\r\n   * Optional selector for inner scrollable content\r\n   * whose max-height will be auto-calculated.\r\n   */\r\n  scrollableSelector = input<string | null>(null);\r\n\r\n  /**\r\n   * Enables or disables automatic repositioning\r\n   * on window scroll and resize.\r\n   *\r\n   * Default: true\r\n   */\r\n  enableAutoReposition = input<boolean>(true);\r\n\r\n  /**\r\n   * List of element IDs or class names\r\n   * whose scrollbars should be hidden\r\n   * while the popup is visible.\r\n   *\r\n   * Examples:\r\n   * ['body']\r\n   * ['app-layout', '.content-wrapper']\r\n   */\r\n  hideScrollTargets = input<string[] | null>(null);\r\n\r\n  /**\r\n   * Hide overlay until positioned to avoid flicker.\r\n   */\r\n  @HostBinding('style.visibility')\r\n  visibility: 'hidden' | 'visible' = 'hidden';\r\n\r\n  ngAfterViewInit(): void {\r\n    const overlay = this.el.nativeElement;\r\n    overlay.style.position = 'fixed';\r\n\r\n    // ResizeObserver always useful (content changes)\r\n    const ro = new ResizeObserver(() => this.updatePosition());\r\n    ro.observe(overlay);\r\n\r\n    const reference = this.getReferenceElement(overlay);\r\n    if (reference) ro.observe(reference);\r\n\r\n    // Conditionally listen to scroll + resize\r\n    if (this.enableAutoReposition()) {\r\n      merge(fromEvent(window, 'scroll'), fromEvent(window, 'resize'))\r\n        .pipe(\r\n          debounceTime(this.debounceMs()),\r\n          takeUntilDestroyed(this.destroyRef),\r\n        )\r\n        .subscribe(() => this.updatePosition());\r\n    }\r\n\r\n    this.updatePosition();\r\n\r\n    (this.destroyRef as any).onDestroy?.(() => ro.disconnect());\r\n  }\r\n\r\n  /**\r\n   * Returns true if the reference element is completely outside viewport.\r\n   * Even 1px visible = considered visible.\r\n   */\r\n  private isReferenceFullyOut(refRect: DOMRect): boolean {\r\n    const vw = window.innerWidth;\r\n    const vh = window.innerHeight;\r\n\r\n    return (\r\n      refRect.bottom <= 0 || // above viewport\r\n      refRect.top >= vh || // below viewport\r\n      refRect.right <= 0 || // left of viewport\r\n      refRect.left >= vw // right of viewport\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calculates and applies overlay position.\r\n   */\r\n  private updatePosition(): void {\r\n    const overlay = this.el.nativeElement;\r\n    const reference = this.getReferenceElement(overlay);\r\n    if (!reference) return;\r\n\r\n    const viewportW = window.innerWidth;\r\n    const viewportH = window.innerHeight;\r\n\r\n    const refRect = reference.getBoundingClientRect();\r\n\r\n    // Optionally match width\r\n    if (this.matchWidth()) {\r\n      overlay.style.width = `${refRect.width}px`;\r\n    }\r\n\r\n    const overlayRect = overlay.getBoundingClientRect();\r\n\r\n    const spaceAbove = refRect.top;\r\n    const spaceBelow = viewportH - refRect.bottom;\r\n\r\n    const openOnTop =\r\n      overlayRect.height > spaceBelow && spaceAbove >= overlayRect.height;\r\n\r\n    // --- base positioning relative to reference ---\r\n    let top = openOnTop\r\n      ? refRect.top - overlayRect.height - this.offset()\r\n      : refRect.bottom + this.offset();\r\n\r\n    let left = refRect.left;\r\n\r\n    const fullyOut = this.isReferenceFullyOut(refRect);\r\n\r\n    if (!fullyOut) {\r\n      // ✅ NORMAL MODE (reference at least partially visible)\r\n      // Clamp to viewport\r\n\r\n      top = Math.min(top, viewportH - overlayRect.height - 4);\r\n      left = Math.min(left, viewportW - overlayRect.width - 4);\r\n    }\r\n    // else: ✅ FOLLOW MODE (reference fully out of viewport)\r\n    // do NOT clamp → let popup go offscreen naturally\r\n    // top & left stay relative to refRect\r\n\r\n    overlay.style.top = `${top}px`;\r\n    overlay.style.left = `${left}px`;\r\n\r\n    // Optional inner scroll container handling\r\n    if (this.scrollableSelector()) {\r\n      const inner = overlay.querySelector(\r\n        this.scrollableSelector()!,\r\n      ) as HTMLElement;\r\n      if (inner) {\r\n        const maxSpace = openOnTop ? spaceAbove : spaceBelow;\r\n        inner.style.maxHeight = `${Math.min(maxSpace - 10, viewportH * 0.9)}px`;\r\n        inner.style.overflowY = 'auto';\r\n      }\r\n    }\r\n\r\n    // visibility safe update\r\n    queueMicrotask(() => {\r\n      this.visibility = 'visible';\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Resolves the reference element.\r\n   */\r\n  private getReferenceElement(overlay: HTMLElement): HTMLElement | null {\r\n    const id = this.referenceElementId();\r\n    return id ? document.getElementById(id) : overlay.parentElement;\r\n  }\r\n}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}