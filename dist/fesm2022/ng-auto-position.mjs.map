{"version":3,"file":"ng-auto-position.mjs","sources":["../../src/app/ng-auto-position/ng-auto-position.directive.ts","../../src/ng-auto-position.ts"],"sourcesContent":["import {\n  AfterViewInit,\n  DestroyRef,\n  Directive,\n  ElementRef,\n  HostBinding,\n  inject,\n  input,\n} from '@angular/core';\nimport { fromEvent, merge } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\nimport { takeUntilDestroyed } from '@angular/core/rxjs-interop';\n\n/**\n * AutoPositionElementDirective\n *\n * Automatically positions an overlay element (dropdown / popover)\n * relative to a reference element and keeps it inside the viewport.\n *\n * DESIGN DECISIONS:\n * - Uses `position: fixed` so viewport math is reliable.\n * - Uses getBoundingClientRect() for all measurements.\n * - Avoids DOM depth assumptions (npm-safe).\n * - Uses ResizeObserver to react to size changes.\n */\n@Directive({\n  selector: '[ngAutoPosition]',\n  standalone: true,\n})\nexport class NgAutoPositionElementDirective implements AfterViewInit {\n  /** Native element reference for the overlay */\n  private readonly el = inject(ElementRef<HTMLElement>);\n\n  /** Used by Angular to auto-clean RxJS subscriptions */\n  private readonly destroyRef = inject(DestroyRef);\n\n  /**\n   * ID of the reference element.\n   * If not provided, parentElement is used.\n   */\n  referenceElementId = input<string | null>(null);\n\n  /** Debounce time for scroll / resize events (ms) */\n  debounceMs = input<number>(0);\n\n  /** Gap between reference and overlay (px) */\n  offset = input<number>(5);\n\n  /** Match overlay width to reference width */\n  matchWidth = input<boolean>(false);\n\n  /**\n   * Optional selector for inner scrollable content\n   * whose max-height will be auto-calculated.\n   */\n  scrollableSelector = input<string | null>(null);\n\n  /**\n   * Enables or disables automatic repositioning\n   * on window scroll and resize.\n   *\n   * Default: true\n   */\n  enableAutoReposition = input<boolean>(true);\n\n  /**\n   * List of element IDs or class names\n   * whose scrollbars should be hidden\n   * while the popup is visible.\n   *\n   * Examples:\n   * ['body']\n   * ['app-layout', '.content-wrapper']\n   */\n  hideScrollTargets = input<string[] | null>(null);\n\n  /**\n   * Hide overlay until positioned to avoid flicker.\n   */\n  @HostBinding('style.visibility')\n  visibility: 'hidden' | 'visible' = 'hidden';\n\n  ngAfterViewInit(): void {\n    const overlay = this.el.nativeElement;\n    overlay.style.position = 'fixed';\n\n    // ResizeObserver always useful (content changes)\n    const ro = new ResizeObserver(() => this.updatePosition());\n    ro.observe(overlay);\n\n    const reference = this.getReferenceElement(overlay);\n    if (reference) ro.observe(reference);\n\n    // Conditionally listen to scroll + resize\n    if (this.enableAutoReposition()) {\n      merge(fromEvent(window, 'scroll'), fromEvent(window, 'resize'))\n        .pipe(\n          debounceTime(this.debounceMs()),\n          takeUntilDestroyed(this.destroyRef),\n        )\n        .subscribe(() => this.updatePosition());\n    }\n\n    this.updatePosition();\n\n    (this.destroyRef as any).onDestroy?.(() => ro.disconnect());\n  }\n\n  /**\n   * Returns true if the reference element is completely outside viewport.\n   * Even 1px visible = considered visible.\n   */\n  private isReferenceFullyOut(refRect: DOMRect): boolean {\n    const vw = window.innerWidth;\n    const vh = window.innerHeight;\n\n    return (\n      refRect.bottom <= 0 || // above viewport\n      refRect.top >= vh || // below viewport\n      refRect.right <= 0 || // left of viewport\n      refRect.left >= vw // right of viewport\n    );\n  }\n\n  /**\n   * Calculates and applies overlay position.\n   */\n  private updatePosition(): void {\n    const overlay = this.el.nativeElement;\n    const reference = this.getReferenceElement(overlay);\n    if (!reference) return;\n\n    const viewportW = window.innerWidth;\n    const viewportH = window.innerHeight;\n\n    const refRect = reference.getBoundingClientRect();\n\n    // Optionally match width\n    if (this.matchWidth()) {\n      overlay.style.width = `${refRect.width}px`;\n    }\n\n    const overlayRect = overlay.getBoundingClientRect();\n\n    const spaceAbove = refRect.top;\n    const spaceBelow = viewportH - refRect.bottom;\n\n    const openOnTop =\n      overlayRect.height > spaceBelow && spaceAbove >= overlayRect.height;\n\n    // --- base positioning relative to reference ---\n    let top = openOnTop\n      ? refRect.top - overlayRect.height - this.offset()\n      : refRect.bottom + this.offset();\n\n    let left = refRect.left;\n\n    const fullyOut = this.isReferenceFullyOut(refRect);\n\n    if (!fullyOut) {\n      // ✅ NORMAL MODE (reference at least partially visible)\n      // Clamp to viewport\n\n      top = Math.min(top, viewportH - overlayRect.height - 4);\n      left = Math.min(left, viewportW - overlayRect.width - 4);\n    }\n    // else: ✅ FOLLOW MODE (reference fully out of viewport)\n    // do NOT clamp → let popup go offscreen naturally\n    // top & left stay relative to refRect\n\n    overlay.style.top = `${top}px`;\n    overlay.style.left = `${left}px`;\n\n    // Optional inner scroll container handling\n    if (this.scrollableSelector()) {\n      const inner = overlay.querySelector(\n        this.scrollableSelector()!,\n      ) as HTMLElement;\n      if (inner) {\n        const maxSpace = openOnTop ? spaceAbove : spaceBelow;\n        inner.style.maxHeight = `${Math.min(maxSpace - 10, viewportH * 0.9)}px`;\n        inner.style.overflowY = 'auto';\n      }\n    }\n\n    // visibility safe update\n    queueMicrotask(() => {\n      this.visibility = 'visible';\n    });\n  }\n\n  /**\n   * Resolves the reference element.\n   */\n  private getReferenceElement(overlay: HTMLElement): HTMLElement | null {\n    const id = this.referenceElementId();\n    return id ? document.getElementById(id) : overlay.parentElement;\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":";;;;;;AAaA;;;;;;;;;;;AAWG;MAKU,8BAA8B,CAAA;;AAExB,IAAA,EAAE,GAAG,MAAM,EAAC,UAAuB,EAAC;;AAGpC,IAAA,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC;AAEhD;;;AAGG;AACH,IAAA,kBAAkB,GAAG,KAAK,CAAgB,IAAI,CAAC;;AAG/C,IAAA,UAAU,GAAG,KAAK,CAAS,CAAC,CAAC;;AAG7B,IAAA,MAAM,GAAG,KAAK,CAAS,CAAC,CAAC;;AAGzB,IAAA,UAAU,GAAG,KAAK,CAAU,KAAK,CAAC;AAElC;;;AAGG;AACH,IAAA,kBAAkB,GAAG,KAAK,CAAgB,IAAI,CAAC;AAE/C;;;;;AAKG;AACH,IAAA,oBAAoB,GAAG,KAAK,CAAU,IAAI,CAAC;AAE3C;;;;;;;;AAQG;AACH,IAAA,iBAAiB,GAAG,KAAK,CAAkB,IAAI,CAAC;AAEhD;;AAEG;IAEH,UAAU,GAAyB,QAAQ;IAE3C,eAAe,GAAA;AACb,QAAA,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa;AACrC,QAAA,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,OAAO;;AAGhC,QAAA,MAAM,EAAE,GAAG,IAAI,cAAc,CAAC,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;AAC1D,QAAA,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC;QAEnB,MAAM,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC;AACnD,QAAA,IAAI,SAAS;AAAE,YAAA,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;;AAGpC,QAAA,IAAI,IAAI,CAAC,oBAAoB,EAAE,EAAE;AAC/B,YAAA,KAAK,CAAC,SAAS,CAAC,MAAM,EAAE,QAAQ,CAAC,EAAE,SAAS,CAAC,MAAM,EAAE,QAAQ,CAAC;AAC3D,iBAAA,IAAI,CACH,YAAY,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,EAC/B,kBAAkB,CAAC,IAAI,CAAC,UAAU,CAAC;iBAEpC,SAAS,CAAC,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;QAC3C;QAEA,IAAI,CAAC,cAAc,EAAE;AAEpB,QAAA,IAAI,CAAC,UAAkB,CAAC,SAAS,GAAG,MAAM,EAAE,CAAC,UAAU,EAAE,CAAC;IAC7D;AAEA;;;AAGG;AACK,IAAA,mBAAmB,CAAC,OAAgB,EAAA;AAC1C,QAAA,MAAM,EAAE,GAAG,MAAM,CAAC,UAAU;AAC5B,QAAA,MAAM,EAAE,GAAG,MAAM,CAAC,WAAW;AAE7B,QAAA,QACE,OAAO,CAAC,MAAM,IAAI,CAAC;AACnB,YAAA,OAAO,CAAC,GAAG,IAAI,EAAE;AACjB,YAAA,OAAO,CAAC,KAAK,IAAI,CAAC;AAClB,YAAA,OAAO,CAAC,IAAI,IAAI,EAAE;;IAEtB;AAEA;;AAEG;IACK,cAAc,GAAA;AACpB,QAAA,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa;QACrC,MAAM,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC;AACnD,QAAA,IAAI,CAAC,SAAS;YAAE;AAEhB,QAAA,MAAM,SAAS,GAAG,MAAM,CAAC,UAAU;AACnC,QAAA,MAAM,SAAS,GAAG,MAAM,CAAC,WAAW;AAEpC,QAAA,MAAM,OAAO,GAAG,SAAS,CAAC,qBAAqB,EAAE;;AAGjD,QAAA,IAAI,IAAI,CAAC,UAAU,EAAE,EAAE;YACrB,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,GAAG,OAAO,CAAC,KAAK,CAAA,EAAA,CAAI;QAC5C;AAEA,QAAA,MAAM,WAAW,GAAG,OAAO,CAAC,qBAAqB,EAAE;AAEnD,QAAA,MAAM,UAAU,GAAG,OAAO,CAAC,GAAG;AAC9B,QAAA,MAAM,UAAU,GAAG,SAAS,GAAG,OAAO,CAAC,MAAM;AAE7C,QAAA,MAAM,SAAS,GACb,WAAW,CAAC,MAAM,GAAG,UAAU,IAAI,UAAU,IAAI,WAAW,CAAC,MAAM;;QAGrE,IAAI,GAAG,GAAG;AACR,cAAE,OAAO,CAAC,GAAG,GAAG,WAAW,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM;cAC9C,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE;AAElC,QAAA,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI;QAEvB,MAAM,QAAQ,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC;QAElD,IAAI,CAAC,QAAQ,EAAE;;;AAIb,YAAA,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,SAAS,GAAG,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC;AACvD,YAAA,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,SAAS,GAAG,WAAW,CAAC,KAAK,GAAG,CAAC,CAAC;QAC1D;;;;QAKA,OAAO,CAAC,KAAK,CAAC,GAAG,GAAG,CAAA,EAAG,GAAG,IAAI;QAC9B,OAAO,CAAC,KAAK,CAAC,IAAI,GAAG,CAAA,EAAG,IAAI,IAAI;;AAGhC,QAAA,IAAI,IAAI,CAAC,kBAAkB,EAAE,EAAE;YAC7B,MAAM,KAAK,GAAG,OAAO,CAAC,aAAa,CACjC,IAAI,CAAC,kBAAkB,EAAG,CACZ;YAChB,IAAI,KAAK,EAAE;gBACT,MAAM,QAAQ,GAAG,SAAS,GAAG,UAAU,GAAG,UAAU;AACpD,gBAAA,KAAK,CAAC,KAAK,CAAC,SAAS,GAAG,CAAA,EAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,GAAG,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI;AACvE,gBAAA,KAAK,CAAC,KAAK,CAAC,SAAS,GAAG,MAAM;YAChC;QACF;;QAGA,cAAc,CAAC,MAAK;AAClB,YAAA,IAAI,CAAC,UAAU,GAAG,SAAS;AAC7B,QAAA,CAAC,CAAC;IACJ;AAEA;;AAEG;AACK,IAAA,mBAAmB,CAAC,OAAoB,EAAA;AAC9C,QAAA,MAAM,EAAE,GAAG,IAAI,CAAC,kBAAkB,EAAE;AACpC,QAAA,OAAO,EAAE,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,aAAa;IACjE;wGAxKW,8BAA8B,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,SAAA,EAAA,CAAA;4FAA9B,8BAA8B,EAAA,YAAA,EAAA,IAAA,EAAA,QAAA,EAAA,kBAAA,EAAA,MAAA,EAAA,EAAA,kBAAA,EAAA,EAAA,iBAAA,EAAA,oBAAA,EAAA,UAAA,EAAA,oBAAA,EAAA,QAAA,EAAA,IAAA,EAAA,UAAA,EAAA,KAAA,EAAA,iBAAA,EAAA,IAAA,EAAA,EAAA,UAAA,EAAA,EAAA,iBAAA,EAAA,YAAA,EAAA,UAAA,EAAA,YAAA,EAAA,QAAA,EAAA,IAAA,EAAA,UAAA,EAAA,KAAA,EAAA,iBAAA,EAAA,IAAA,EAAA,EAAA,MAAA,EAAA,EAAA,iBAAA,EAAA,QAAA,EAAA,UAAA,EAAA,QAAA,EAAA,QAAA,EAAA,IAAA,EAAA,UAAA,EAAA,KAAA,EAAA,iBAAA,EAAA,IAAA,EAAA,EAAA,UAAA,EAAA,EAAA,iBAAA,EAAA,YAAA,EAAA,UAAA,EAAA,YAAA,EAAA,QAAA,EAAA,IAAA,EAAA,UAAA,EAAA,KAAA,EAAA,iBAAA,EAAA,IAAA,EAAA,EAAA,kBAAA,EAAA,EAAA,iBAAA,EAAA,oBAAA,EAAA,UAAA,EAAA,oBAAA,EAAA,QAAA,EAAA,IAAA,EAAA,UAAA,EAAA,KAAA,EAAA,iBAAA,EAAA,IAAA,EAAA,EAAA,oBAAA,EAAA,EAAA,iBAAA,EAAA,sBAAA,EAAA,UAAA,EAAA,sBAAA,EAAA,QAAA,EAAA,IAAA,EAAA,UAAA,EAAA,KAAA,EAAA,iBAAA,EAAA,IAAA,EAAA,EAAA,iBAAA,EAAA,EAAA,iBAAA,EAAA,mBAAA,EAAA,UAAA,EAAA,mBAAA,EAAA,QAAA,EAAA,IAAA,EAAA,UAAA,EAAA,KAAA,EAAA,iBAAA,EAAA,IAAA,EAAA,EAAA,EAAA,IAAA,EAAA,EAAA,UAAA,EAAA,EAAA,kBAAA,EAAA,iBAAA,EAAA,EAAA,EAAA,QAAA,EAAA,EAAA,EAAA,CAAA;;4FAA9B,8BAA8B,EAAA,UAAA,EAAA,CAAA;kBAJ1C,SAAS;AAAC,YAAA,IAAA,EAAA,CAAA;AACT,oBAAA,QAAQ,EAAE,kBAAkB;AAC5B,oBAAA,UAAU,EAAE,IAAI;AACjB,iBAAA;8BAoDC,UAAU,EAAA,CAAA;sBADT,WAAW;uBAAC,kBAAkB;;;AC/EjC;;AAEG;;;;"}